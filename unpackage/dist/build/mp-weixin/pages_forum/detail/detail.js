(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages_forum/detail/detail"],{2186:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var i={uSkeleton:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-skeleton/u-skeleton")]).then(n.bind(null,"0806"))},uniDateformat:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat")]).then(n.bind(null,"ebdb"))},uParse:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-parse/u-parse")]).then(n.bind(null,"e14d"))},uEmpty:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-empty/u-empty")]).then(n.bind(null,"5b1e"))},commentItem:function(){return n.e("components/comment-item/comment-item").then(n.bind(null,"741b"))},commentFrame:function(){return n.e("components/comment-frame/comment-frame").then(n.bind(null,"7475"))}},r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.loadState?null:e.giveDefaultAvatar(e.detailObj)),i=e.loadState?null:e.giveName(e.detailObj),r=e.loadState?null:e.__map(e.likeUserArr,(function(t,n){var i=e.__get_orig(t),r=e.giveDefaultAvatar(t);return{$orig:i,m2:r}})),a=!e.commentList.length&&e.noComment,o=e.commentList.length;e.$mp.data=Object.assign({},{$root:{m0:n,m1:i,l0:r,g0:a,g1:o}})},a=[]},"24fa":function(e,t,n){"use strict";n.r(t);var i=n("9046"),r=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"56be":function(e,t,n){"use strict";var i=n("eafb"),r=n.n(i);r.a},9046:function(e,t,n){"use strict";(function(e,i){var r=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("2eee")),o=r(n("c973")),u=r(n("9523")),c=r(n("07fd")),l=n("f7ea"),s=n("2da8");function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,u.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=e.database(),p=e.importObject("utilsObj",{customUI:!0}),g={data:function(){return{artid:"",loadState:!0,tagStyle:{p:"line-height:1.7em;font-size:16px;padding-bottom:10rpx",img:"margin:10rpx 0"},detailObj:null,likeUserArr:[],commentObj:{article_id:"",comment_type:0},commentList:[],noComment:!1}},onLoad:function(e){e.id?(this.artid=e.id,this.commentObj.article_id=e.id,this.getData(),this.readUpdate(),this.getLikeUser(),this.getComment()):this.errFun()},methods:{giveName:l.giveName,giveDefaultAvatar:l.giveDefaultAvatar,PcommentEnv:function(e){console.log(e),this.commentList.unshift(m(m(m({},this.commentObj),e),{},{user_id:[s.store.userInfo]}))},PremoveEnv:function(e){console.log(e);var t=this.commentList.findIndex((function(t){return t._id==e.id}));this.commentList.splice(t,1)},getComment:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n,i,r,o,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=f.collection("quanzi_comment").where('article_id == "'.concat(e.artid,'" && comment_type==0')).orderBy("comment_date desc").limit(20).getTemp(),i=f.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp(),t.next=4,f.collection(n,i).get();case 4:return r=t.sent,o=r.result.data.map((function(e){return e._id})),t.next=8,f.collection("quanzi_comment").where({reply_comment_id:f.command.in(o)}).groupBy("reply_comment_id").groupField("count(*) as totalReply").get();case 8:u=t.sent,r.result.data.forEach((function(e){var t=u.result.data.findIndex((function(t){return t.reply_comment_id==e._id}));t>-1&&(e.totalReply=u.result.data[t].totalReply)})),0==r.result.data&&(e.noComment=!0),e.commentList=r.result.data;case 12:case"end":return t.stop()}}),t)})))()},getLikeUser:function(){var e=this,t=f.collection("quanzi_like").where('article_id == "'.concat(this.artid,'"')).getTemp(),n=f.collection("uni-id-users").field("_id,avatar_file").getTemp();f.collection(t,n).orderBy("publish_date desc").limit(5).get().then((function(t){console.log(t),t.result.data=t.result.data.reverse(),e.likeUserArr=t.result.data}))},clickLike:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s.store.hasLogin){t.next=3;break}return i.showModal({title:"登录后才可进行后续操作",success:function(e){e.confirm&&i.navigateTo({url:"/"+c.default.uniIdRouter.loginPage})}}),t.abrupt("return");case 3:if(n=Date.now(),!(n-e.likeTime<2e3)){t.next=7;break}return i.showToast({title:"操作太频繁，请稍后...",icon:"none"}),t.abrupt("return");case 7:e.detailObj.isLike?e.detailObj.like_count--:e.detailObj.like_count++,e.detailObj.isLike=!e.detailObj.isLike,e.likeTime=n,(0,l.likeFun)(e.artid);case 11:case"end":return t.stop()}}),t)})))()},readUpdate:function(){p.operation("quanzi_article","view_count",this.artid,1).then((function(e){console.log(e)}))},errFun:function(){i.showToast({title:"参数有误",icon:"none"}),setTimeout((function(){i.reLaunch({url:"/pages/index/index"})}),1e3)},getData:function(){var e=this,t=f.collection("quanzi_article").where('_id=="'.concat(this.artid,'"')).getTemp(),n=f.collection("uni-id-users").field("_id,username,nickname,avatar_file").getTemp(),r=f.collection("quanzi_like").where('article_id=="'.concat(this.artid,'" && user_id==$cloudEnv_uid')).getTemp(),a=[t,n];s.store.hasLogin&&a.push(r),f.collection.apply(f,a).get({getOne:!0}).then((function(t){if(console.log(t),t.result.data){e.loadState=!1;var n=!1;s.store.hasLogin&&(n=!!t.result.data._id.quanzi_like.length),t.result.data.isLike=n,e.detailObj=t.result.data,i.setNavigationBarTitle({title:e.detailObj.title})}else e.errFun()})).catch((function(t){e.errFun()}))}}};t.default=g}).call(this,n("a9ff")["default"],n("543d")["default"])},"96f7":function(e,t,n){"use strict";n.r(t);var i=n("2186"),r=n("24fa");for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("56be");var o=n("f0c5"),u=Object(o["a"])(r["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=u.exports},c1b4:function(e,t,n){"use strict";(function(e,t){var i=n("4ea4");n("0be4"),n("a9ff");i(n("66fd"));var r=i(n("96f7"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},eafb:function(e,t,n){}},[["c1b4","common/runtime","common/vendor"]]]);